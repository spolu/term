<!DOCTYPE html>

<html>
<head>
  <title>vt.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="colors_s.html">
                colors_s.js
              </a>
            
              
              <a class="source" href="keymap_f.html">
                keymap_f.js
              </a>
            
              
              <a class="source" href="session_s.html">
                session_s.js
              </a>
            
              
              <a class="source" href="stack_d.html">
                stack_d.js
              </a>
            
              
              <a class="source" href="term_d.html">
                term_d.js
              </a>
            
              
              <a class="source" href="char_map.html">
                char_map.js
              </a>
            
              
              <a class="source" href="common.html">
                common.js
              </a>
            
              
              <a class="source" href="session.html">
                session.js
              </a>
            
              
              <a class="source" href="term.html">
                term.js
              </a>
            
              
              <a class="source" href="vt.html">
                vt.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>vt.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*
 * breach: vt.js
 *
 * Copyright (c) 2013, Stanislas Polu. All rights reserved.
 * (see LICENSE file)
 *
 * @log
 * - 20130514 @spolu    Fixes to properly run vim
 * - 20130510 @spolu    Fixes first time running vim
 * - 20130429 @spolu    First stabilized API
 * - 20130410 @spolu    Fork from hterm
 */</span>
<span class="string">'use strict'</span>;

<span class="keyword">var</span> common = require(<span class="string">'./common.js'</span>);
<span class="keyword">var</span> events = require(<span class="string">'events'</span>);
<span class="keyword">var</span> util = require(<span class="string">'util'</span>);
<span class="keyword">var</span> factory = common.factory({ debug: <span class="literal">false</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>state</h2>
<p>Helper class to represent the parser state</p>
<pre><code>@inherits {}
@spec {object} { def_fun }</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> state = <span class="keyword">function</span>(spec, my) {
  <span class="keyword">var</span> _super = {};
  my = my || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4><em>private members</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.def_fun = spec.def_fun
  my.buf = <span class="literal">null</span>;
  my.pos = <span class="number">0</span>;
  my.fun = my.def_fun;
  my.args = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4><em>public methods</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> reset_fun;   <span class="comment">/* reset_fun(); */</span>
  <span class="keyword">var</span> reset_buf;   <span class="comment">/* reset_buf([buf]); */</span>
  <span class="keyword">var</span> reset_args   <span class="comment">/* reset_args(); */</span>
  <span class="keyword">var</span> reset;       <span class="comment">/* reset([buf]); */</span>
  <span class="keyword">var</span> int_arg;     <span class="comment">/* int_arg(pos, [def_value]); */</span>
  <span class="keyword">var</span> advance;     <span class="comment">/* advance(count); */</span>
  <span class="keyword">var</span> peek_buf;    <span class="comment">/* peek_buf(); */</span>
  <span class="keyword">var</span> peek;        <span class="comment">/* peek(); */</span>
  <span class="keyword">var</span> consume;     <span class="comment">/* consume(); */</span>
  <span class="keyword">var</span> is_complete; <span class="comment">/* is_complete(); */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4><em>that</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> that = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>reset_fun</h3>
<p>Resets the parser function only.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset_fun = <span class="keyword">function</span>() {
    my.fun = my.def_fun;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3>reset_buf</h3>
<pre><code>@buf {string} optional value for buffer (defaults to null)</code></pre>
<p>Resets the buffer and position only.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset_buf = <span class="keyword">function</span>(buf) {
    my.buf = (<span class="keyword">typeof</span> buf === <span class="string">'string'</span>) ? buf : <span class="literal">null</span>;
    my.pos = <span class="number">0</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3>reset_args</h3>
<pre><code>@arg {string} optional value for args[0]</code></pre>
<p>Resets the arguments list only</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset_args = <span class="keyword">function</span>(arg) {
    my.args = [];
    <span class="keyword">if</span>(<span class="keyword">typeof</span> arg !== <span class="string">'undefined'</span>) {
      my.args[<span class="number">0</span>] = arg;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>reset</h3>
<pre><code>@buf {string} optional value for buffer</code></pre>
<p>Reset the parser state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset = <span class="keyword">function</span>(buf) {
    that.reset_fun();
    that.reset_buf(buf);
    that.reset_args();
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3>int_arg</h3>
<pre><code>@pos {number} the argument number to retrieve
@def {numnber} the default value to return</code></pre>
<p>Get an argument as an integer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  int_arg = <span class="keyword">function</span>(pos, def) {
    <span class="keyword">var</span> str = my.args[pos];
    <span class="keyword">if</span>(str) {
      <span class="keyword">var</span> ret = parseInt(str, <span class="number">10</span>);
      <span class="keyword">if</span>(ret === <span class="number">0</span>)
        ret = def;
      <span class="keyword">return</span> ret;
    }
    <span class="keyword">return</span> def;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3>advance</h3>
<pre><code>@count {number} the number of bytes to advance</code></pre>
<p>Advances the parse position </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  advance = <span class="keyword">function</span>(count) {
    my.pos += count;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3>peek_buf</h3>
<p>Return the remaining portion of the buffer without affecting the state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  peek_buf = <span class="keyword">function</span>() {
    <span class="keyword">return</span> my.buf.substr(my.pos);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h3>peek</h3>
<p>Return the next character of the buffer without affecting the state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  peek = <span class="keyword">function</span>() {
    <span class="keyword">return</span> my.buf.substr(my.pos, <span class="number">1</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3>consume_char</h3>
<p>Return the next character in the buffer and advance the parse
position of one byte.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  consume = <span class="keyword">function</span>() {
    <span class="keyword">return</span> my.buf.substr(my.pos++, <span class="number">1</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3>is_complete</h3>
<p>Returns whether the buffer is empty or the position is past
the end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  is_complete = <span class="keyword">function</span>() {
    <span class="keyword">return</span> my.buf === <span class="literal">null</span> || my.buf.length &lt;= my.pos;
  };


  common.method(that, <span class="string">'reset_fun'</span>, reset_fun, _super);
  common.method(that, <span class="string">'reset_buf'</span>, reset_buf, _super);
  common.method(that, <span class="string">'reset_args'</span>, reset_args, _super);
  common.method(that, <span class="string">'reset'</span>, reset, _super);
  common.method(that, <span class="string">'int_arg'</span>,int_arg , _super);
  common.method(that, <span class="string">'advance'</span>, advance, _super);
  common.method(that, <span class="string">'peek_buf'</span>, peek_buf, _super);
  common.method(that, <span class="string">'peek'</span>, peek, _super);
  common.method(that, <span class="string">'consume'</span>, consume, _super);
  common.method(that, <span class="string">'is_complete'</span>, is_complete, _super);

  common.getter(that, <span class="string">'buf'</span>, my, <span class="string">'buf'</span>);
  common.getter(that, <span class="string">'pos'</span>, my, <span class="string">'pos'</span>);
  common.getter(that, <span class="string">'fun'</span>, my, <span class="string">'fun'</span>);
  common.setter(that, <span class="string">'fun'</span>, my, <span class="string">'fun'</span>);
  common.getter(that, <span class="string">'args'</span>, my, <span class="string">'args'</span>);

  <span class="keyword">return</span> that;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2>vt</h2>
<p>Escape sequence interpreter </p>
<p>The <code>vt</code> object is in charge of parsing and interpreting the
sequence sent to the terminal and pass them to the terminal
to execute cursor operations.</p>
<p>Originally forked from:
Chromium&#39;s hterm [<a href="http://goo.gl/3i5AJ">http://goo.gl/3i5AJ</a>]
Copyright (c) 2012 The Chromium OS Authors. All rights reserved.
<a href="http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE?view=markup">http://src.chromium.org/viewvc/chrome/trunk/src/LICENSE?view=markup</a></p>
<h4>Guides:</h4>
<ul>
<li>[VT100] VT100 User Guide
<a href="http://vt100.net/docs/vt100-ug/chapter3.html">http://vt100.net/docs/vt100-ug/chapter3.html</a></li>
<li>[VT510] VT510 Video Terminal Programmer Information
<a href="http://vt100.net/docs/vt510-rm/contents">http://vt100.net/docs/vt510-rm/contents</a></li>
<li>[XTERM] Xterm Control Sequences
<a href="http://invisible-island.net/xterm/ctlseqs/ctlseqs.html">http://invisible-island.net/xterm/ctlseqs/ctlseqs.html</a></li>
<li>[CTRL]  Wikipedia: C0 and C1 Control Codes
<a href="http://en.wikipedia.org/wiki/C0_and_C1_control_codes">http://en.wikipedia.org/wiki/C0_and_C1_control_codes</a></li>
<li>[CSI]   Wikipedia: ANSI Escape Code
<a href="http://en.wikipedia.org/wiki/Control_Sequence_Introducer">http://en.wikipedia.org/wiki/Control_Sequence_Introducer</a></li>
</ul>
<pre><code>@spec {object} { 
    allow_width_change,  [optional]
    osc_time_limit,      [optional]
    max_string_sequence, [optional]
    warn                 [optional]
 }</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> vt = <span class="keyword">function</span>(spec, my) {
  <span class="keyword">var</span> _super = {};
  my = my || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h4><em>protected methods</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> parse_unknown;  <span class="comment">/* parse_unknown(); */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h4><em>private methods</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> save_cursor;                   <span class="comment">/* cursor_save(); */</span>
  <span class="keyword">var</span> restore_cursor;                <span class="comment">/* cursor_reset(); */</span>
  <span class="keyword">var</span> parse_unknown;                 <span class="comment">/* parse_unknown(); */</span>
  <span class="keyword">var</span> parse_csi;                     <span class="comment">/* parse_csi(); */</span>
  <span class="keyword">var</span> parse_until_string_terminator; <span class="comment">/* parse_until_string_terminator */</span>
  <span class="keyword">var</span> dispatch;                      <span class="comment">/* dispatch(); */</span>
  <span class="keyword">var</span> ignore;                        <span class="comment">/* ignore(); */</span>
  <span class="keyword">var</span> set_ansi_mode;                 <span class="comment">/* set_ansi_mode(code, state); */</span>
  <span class="keyword">var</span> set_dec_mode;                  <span class="comment">/* set_dec_mode(code, state); */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h4><em>private members</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.state = <span class="literal">null</span>;
  my.leading_modifier = <span class="string">''</span>;
  my.trailing_modifier = <span class="string">''</span>;
  my.allow_width_change = spec.allow_width_change || <span class="literal">true</span>;
  my.osc_time_limit = spec.osc_time_limit || <span class="number">2000</span>;
  my.max_string_sequence = spec.max_string_sequence || <span class="number">1024</span>;
  my.warn = spec.warn || <span class="literal">true</span>;
  my.saved_state = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h4><em>public methods</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> reset;      <span class="comment">/* reset(); */</span>
  <span class="keyword">var</span> read;       <span class="comment">/* read(); */</span>
  
  <span class="keyword">var</span> that = <span class="keyword">new</span> events.EventEmitter();</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3>cursor_save</h3>
<p>Saves the cursor state and emits a <code>save_cursor</code> event for the terminal
to save its actual cursor state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  save_cursor = <span class="keyword">function</span>() {
    my.saved_state = {
      GL: my.GL,
      GR: my.GR,

      G0: my.G0,
      G1: my.G1,
      G2: my.G2,
      G4: my.G3
    };

    <span class="comment">/* Saves cursor and text attributes */</span>
    that.emit(<span class="string">'save_cursor'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3>cursor_restore</h3>
<p>Restores the cursor state and emits a <code>restor_cursor</code> event for the
terminal to restor its cursor state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  restore_cursor = <span class="keyword">function</span>() {
    my.GL = my.saved_state.GL;
    my.GR = my.saved_state.GR;

    my.G0 = my.saved_state.G0;
    my.G1 = my.saved_state.G1;
    my.G2 = my.saved_state.G2;
    my.G3 = my.saved_state.G3;

    <span class="comment">/* Restores cursor and text attributes */</span>
    that.emit(<span class="string">'restore_cursor'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h3>reset</h3>
<p>Resets the VT to its initial default state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset = <span class="keyword">function</span>() {
    <span class="comment">/* We initialize the state here if not already done since we need to */</span>
    <span class="comment">/* wait for parse_unknown to be defined to construct it              */</span>
    <span class="keyword">if</span>(!my.state)
      my.state = state({ def_fun: parse_unknown })

    my.G0 = require(<span class="string">'./char_map.js'</span>).maps[<span class="string">'B'</span>];
    my.G1 = require(<span class="string">'./char_map.js'</span>).maps[<span class="string">'0'</span>];
    my.G2 = require(<span class="string">'./char_map.js'</span>).maps[<span class="string">'B'</span>];
    my.G3 = require(<span class="string">'./char_map.js'</span>).maps[<span class="string">'B'</span>];

    my.GL = <span class="string">'G0'</span>;
    my.GR = <span class="string">'G0'</span>;

    my.saved_state = {
      GL: my.GL,
      GR: my.GR,
      G0: my.G0,
      G1: my.G1,
      G2: my.G2,
      G4: my.G3
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h3>read</h3>
<pre><code>@buf The string bufffer to read</code></pre>
<p>Reads a string of character, inteprets it and pass it the the
underlying terminal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  read = <span class="keyword">function</span>(buf) {
    <span class="keyword">var</span> str = buf;
    str = str.replace(<span class="regexp">/\x00/g</span>, <span class="string">'\\x00'</span>);
    str = str.replace(<span class="regexp">/\x05/g</span>, <span class="string">'\\x05'</span>);
    str = str.replace(<span class="regexp">/\x07/g</span>, <span class="string">'\\x07'</span>);
    str = str.replace(<span class="regexp">/\x08/g</span>, <span class="string">'\\x08'</span>);
    str = str.replace(<span class="regexp">/\x09/g</span>, <span class="string">'\\x09'</span>);
    str = str.replace(<span class="regexp">/\x0a/g</span>, <span class="string">'\\x0a'</span>);
    str = str.replace(<span class="regexp">/\x0b/g</span>, <span class="string">'\\x0b'</span>);
    str = str.replace(<span class="regexp">/\x0c/g</span>, <span class="string">'\\x0c'</span>);
    str = str.replace(<span class="regexp">/\x0d/g</span>, <span class="string">'\\x0d'</span>);
    str = str.replace(<span class="regexp">/\x0e/g</span>, <span class="string">'\\x0e'</span>);
    str = str.replace(<span class="regexp">/\x0f/g</span>, <span class="string">'\\x0f'</span>);
    str = str.replace(<span class="regexp">/\x11/g</span>, <span class="string">'\\x11'</span>);
    str = str.replace(<span class="regexp">/\x13/g</span>, <span class="string">'\\x13'</span>);
    str = str.replace(<span class="regexp">/\x18/g</span>, <span class="string">'\\x18'</span>);
    str = str.replace(<span class="regexp">/\x1a/g</span>, <span class="string">'\\x1a'</span>);
    str = str.replace(<span class="regexp">/\x1b/g</span>, <span class="string">'\\x1b'</span>);
    str = str.replace(<span class="regexp">/\x7f/g</span>, <span class="string">'\\x7f'</span>);
    factory.log().debug(<span class="string">'PTY: '</span> + str);

    my.state.reset_buf(buf.toString(<span class="string">'utf8'</span>));

    <span class="keyword">while</span>(!my.state.is_complete()) {
      <span class="keyword">var</span> fun = my.state.fun();
      <span class="keyword">var</span> buf = my.state.buf();
      <span class="keyword">var</span> pos = my.state.pos();

      my.state.fun()();
      <span class="keyword">if</span>(my.state.fun() === fun &amp;&amp;
         my.state.buf() === buf &amp;&amp;
         my.state.pos() === pos) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Parser `fun` failed to alter state'</span>);
      }
    }
  };

  <span class="comment">/****************************************************************************/</span>
  <span class="comment">/*                               PARSERS                                    */</span>
  <span class="comment">/****************************************************************************/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h3>parse_unknown</h3>
<p>Default parse function. Scans the string for 1-byte control character
(C0/C1 from [CTRL]). Any plain text coming before the code will be printed
normally to the terminal, the the control character will be dispatched.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  parse_unknown = <span class="keyword">function</span>() {
    <span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(str)</span> {</span>
      <span class="keyword">var</span> str;
      <span class="keyword">if</span>(my[my.GL].GL)
        str = my[my.GL].GL(str);
      <span class="keyword">if</span>(my[my.GR].RL)
        str = my[my.GR].GR(str);
      that.emit(<span class="string">'print'</span>, str);
    };

    <span class="keyword">var</span> buf = my.state.peek_buf();
    <span class="keyword">var</span> next_control = buf.search(my.cc1_r);

    <span class="keyword">if</span>(next_control === <span class="number">0</span>) {
      <span class="comment">/* We just stumbled into a control character */</span>
      dispatch(<span class="string">'CC1'</span>, buf.substr(<span class="number">0</span>, <span class="number">1</span>));
      my.state.advance(<span class="number">1</span>);
    }
    <span class="keyword">else</span> <span class="keyword">if</span>(next_control === -<span class="number">1</span>) {
      <span class="comment">/* No control character, we print */</span>
      print(buf);
      my.state.reset();
    }
    <span class="keyword">else</span> {
      print(buf.substr(<span class="number">0</span>, next_control));
      dispatch(<span class="string">'CC1'</span>, buf.substr(next_control, <span class="number">1</span>));
      my.state.advance(next_control + <span class="number">1</span>);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3>parse_csi</h3>
<p>Parse a Control Sequence Introducer code and dispatch it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  parse_csi = <span class="keyword">function</span>() {
    <span class="keyword">var</span> ch = my.state.peek();
    <span class="keyword">var</span> args = my.state.args();

    <span class="keyword">if</span>(ch &gt;= <span class="string">'@'</span> &amp;&amp; ch &lt;= <span class="string">'~'</span>) {
      <span class="comment">/* This is the final character */</span>
      dispatch(<span class="string">'CSI'</span>, my.leading_modifier + my.trailing_modifier + ch);
      my.state.reset_fun();
    }
    <span class="keyword">else</span> <span class="keyword">if</span>(ch === <span class="string">';'</span>) {
      <span class="comment">/* Parameter delimiter */</span>
      <span class="keyword">if</span>(my.trailing_modifier) {
        <span class="comment">/* Parameter delimiter after the trailing modifier. paddlin' */</span>
        my.state.reset_fun();
      }
      <span class="keyword">else</span> {
        <span class="keyword">if</span>(!args.length) {
          <span class="comment">/* They omitted the first param. we supply it */</span>
          args.push(<span class="string">''</span>);
        }
        args.push(<span class="string">''</span>);
      }
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) {
      <span class="keyword">if</span>(my.trailing_modifier) {
        my.state.reset_fun();
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(!args.length) {
        args[<span class="number">0</span>] = ch;
      }
      <span class="keyword">else</span> {
        args[args.length - <span class="number">1</span>] += ch;
      }
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (ch &gt;= <span class="string">' '</span> &amp;&amp; ch &lt;= <span class="string">'?'</span> &amp;&amp; ch != <span class="string">':'</span>) {
      <span class="keyword">if</span>(!args.length) {
        my.leading_modifier += ch;
      }
      <span class="keyword">else</span> {
        my.trailing_modifier += ch;
      }
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (my.cc1_r.test(ch)) {
      dispatch(<span class="string">'CC1'</span>, ch);
    }
    <span class="keyword">else</span> {
      my.state.reset_fun();
    }
    my.state.advance(<span class="number">1</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h3>parse_until_string_terminator</h3>
<pre><code>@return {boolean} if true, parsing is complete else it exceeded</code></pre>
<p>Skip over the string until the next String Terminator (ST, &#39;ESC \&#39;) or
Bell (BEL, &#39;\x07&#39;)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  parse_until_string_terminator = <span class="keyword">function</span>() {
    <span class="keyword">var</span> buf = my.state.peek_buf();
    <span class="keyword">var</span> next_terminator = buf.search(<span class="regexp">/(\x1b\\|\x07)/</span>);
    <span class="keyword">var</span> args = my.state.args();

    <span class="keyword">if</span>(!args.length) {
      args[<span class="number">0</span>] = <span class="string">''</span>;
      args[<span class="number">1</span>] = <span class="keyword">new</span> Date();
    }

    <span class="keyword">if</span>(next_terminator === -<span class="number">1</span>) {
      <span class="comment">/* No terminator here, have to wait for the next string */</span>
      args[<span class="number">0</span>] += buf;

      <span class="keyword">var</span> abort;
      <span class="keyword">if</span>(args[<span class="number">0</span>].length &gt; my.max_string_sequence)
        abort = <span class="string">'Too long: '</span> + args[<span class="number">0</span>].length;
      <span class="keyword">if</span>(args[<span class="number">0</span>].indexOf(<span class="string">'\x1b'</span>) !== -<span class="number">1</span>)
        abort = <span class="string">'Embedded escape: '</span> + args[<span class="number">0</span>].indexOf(<span class="string">'\x1b'</span>);
      <span class="keyword">if</span>(<span class="keyword">new</span> Date() - args[<span class="number">1</span>] &gt; my.osc_time_limit)
        abort = <span class="string">'Timeout expired: '</span> + (<span class="keyword">new</span> Date() - args[<span class="number">1</span>]);

      <span class="keyword">if</span>(abort) {
        factory.log().out(<span class="string">'`parse_until_string_terminator` aborting: '</span> + 
                          abort + <span class="string">' ['</span> + args[<span class="number">0</span>] + <span class="string">']'</span>);
        my.state.reset(args[<span class="number">0</span>]);
        <span class="keyword">return</span> <span class="literal">false</span>;
      }
      
      my.state.advance(buf.length);
      <span class="keyword">return</span> <span class="literal">true</span>;
    }
    <span class="keyword">else</span> <span class="keyword">if</span>((args[<span class="number">0</span>].length + next_terminator) &gt; my.max_string_sequence) {
      <span class="comment">/* Found the end of sequence but it's too long */</span>
      my.state.reset(args[<span class="number">0</span>] + buf);
      <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">else</span> {
      <span class="comment">/* Found the terminator. String is accumulated in args[0] */</span>
      args[<span class="number">0</span>] += buf.substr(<span class="number">0</span>, next_terminator);
      my.state.reset_fun();
      my.state.advance(next_terminator +
                             (buf.substr(next_terminator, <span class="number">1</span>) === <span class="string">'\x1b'</span> ? 
                              <span class="number">2</span> : <span class="number">1</span>));
      <span class="keyword">return</span> <span class="literal">true</span>;
    }
  };

  <span class="comment">/****************************************************************************/</span>
  <span class="comment">/*                               DISPATCH                                   */</span>
  <span class="comment">/****************************************************************************/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h3>dispatch</h3>
<pre><code>@type {string} the escape sequence type
@code {string} the escape sequence code</code></pre>
<p>Dispatch to the function that handles the given CC1, ESC, CSI or VT52 code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dispatch = <span class="keyword">function</span>(type, code) {
    <span class="keyword">var</span> handler = my[type][code];
    <span class="keyword">if</span>(!handler || handler === ignore) {
      <span class="keyword">if</span>(my.warn) {
        factory.log().out(<span class="string">'Unknown/Ignore '</span> + type + <span class="string">' code: '</span> + code);
        <span class="comment">/* factory.log().out(new Error().stack); */</span>
      }
      <span class="keyword">return</span>;
    }
    <span class="keyword">if</span>(type === <span class="string">'CC1'</span> &amp;&amp; code &gt; <span class="string">'\x7f'</span>) {
      <span class="comment">/* We don't handle 8-bit controls. So let's just ignore */</span>
      <span class="keyword">if</span>(my.warn) {
        factory.log().out(<span class="string">'Ignored 8-bit control code: 0x'</span> + 
                          code.charCodeAt(<span class="number">0</span>).toString(<span class="number">16</span>));
      }
      <span class="keyword">return</span>;
    }
    <span class="keyword">return</span> handler(code);
  };

  <span class="comment">/****************************************************************************/</span>
  <span class="comment">/*                                  MODES                                   */</span>
  <span class="comment">/****************************************************************************/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3>set_ansi_mode</h3>
<pre><code>@code {string} the code of the ANSI mode to switch to
@state {boolean} mode state</code></pre>
<p>Set one o the ANSI defined terminal mode bits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set_ansi_mode = <span class="keyword">function</span>(code, state) {
    <span class="keyword">if</span>(code === <span class="string">'4'</span>)
      that.emit(<span class="string">'set_insert_mode'</span>, state)
    <span class="keyword">else</span> <span class="keyword">if</span>(code === <span class="string">'20'</span>)
      that.emit(<span class="string">'set_auto_carriage_return'</span>, state)
    <span class="keyword">else</span> <span class="keyword">if</span>(my.warn)
      factory.log().out(<span class="string">'Unimplemented ANSI Mode: '</span> + code);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3>set_dec_mode</h3>
<pre><code>@code {string} the code of the DEC mode to switch to
@state {boolean} mode state</code></pre>
<p>Invoked in response to DECSET/DECRST.
Expected values for code:
    1 - Application Cursor Keys (DECCKM).
    2 - [!] Designate USASCII for character sets G0-G3 (DECANM), and set
        VT100 mode.
    3 - 132 Column Mode (DECCOLM).
    4 - [x] Smooth (Slow) Scroll (DECSCLM).
    5 - Reverse Video (DECSCNM).
    6 - Origin Mode (DECOM).
    7 - Wraparound Mode (DECAWM).
    8 - [x] Auto-repeat Keys (DECARM).
    9 - [!] Send Mouse X &amp; Y on button press.
   10 - [x] Show toolbar (rxvt).
   12 - Start Blinking Cursor (att610).
   18 - [!] Print form feed (DECPFF).
   19 - [x] Set print extent to full screen (DECPEX).
   25 - Show Cursor (DECTCEM).
   30 - [!] Show scrollbar (rxvt).
   35 - [x] Enable font-shifting functions (rxvt).
   38 - [x] Enter Tektronix Mode (DECTEK).
   40 - Allow 80 - 132 Mode.
   41 - [!] more(1) fix (see curses resource).
   42 - [!] Enable Nation Replacement Character sets (DECNRCM).
   44 - [!] Turn On Margin Bell.
   45 - Reverse-wraparound Mode.
   46 - [x] Start Logging.
   47 - [!] Use Alternate Screen Buffer.
   66 - [!] Application keypad (DECNKM).
   67 - Backarrow key sends backspace (DECBKM).
 1000 - Send Mouse X &amp; Y on button press and release.  (MOUSE_REPORT_CLICK)
 1001 - [!] Use Hilite Mouse Tracking.
 1002 - Use Cell Motion Mouse Tracking.  (MOUSE_REPORT_DRAG)
 1003 - [!] Use All Motion Mouse Tracking.
 1004 - [!] Send FocusIn/FocusOut events.
 1005 - [!] Enable Extended Mouse Mode.
 1010 - Scroll to bottom on tty output (rxvt).
 1011 - Scroll to bottom on key press (rxvt).
 1034 - [x] Interpret &quot;meta&quot; key, sets eighth bit.
 1035 - [x] Enable special modifiers for Alt and NumLock keys.
 1036 - Send ESC when Meta modifies a key.
 1037 - [!] Send DEL from the editing-keypad Delete key.
 1039 - Send ESC when Alt modifies a key.
 1040 - [x] Keep selection even if not highlighted.
 1041 - [x] Use the CLIPBOARD selection.
 1042 - [!] Enable Urgency window manager hint when Control-G is received.
 1043 - [!] Enable raising of the window when Control-G is received.
 1047 - [!] Use Alternate Screen Buffer.
 1048 - Save cursor as in DECSC.
 1049 - Save cursor as in DECSC and use Alternate Screen Buffer, clearing
        it first. (This may be disabled by the titeInhibit resource). This
        combines the effects of the 1047 and 1048 modes. Use this with
        terminfo-based applications rather than the 47 mode.
 1050 - [!] Set terminfo/termcap function-key mode.
 1051 - [x] Set Sun function-key mode.
 1052 - [x] Set HP function-key mode.
 1053 - [x] Set SCO function-key mode.
 1060 - [x] Set legacy keyboard emulation (X11R6).
 1061 - [!] Set VT220 keyboard emulation.
 2004 - [!] Set bracketed paste mode.</p>
<p>[!] - Not currently implemented, may be in the future.
[x] - Will not implement.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set_dec_mode = <span class="keyword">function</span>(code, state) {
    <span class="keyword">switch</span>(code) {
      <span class="keyword">case</span> <span class="string">'1'</span>: {
        that.emit(<span class="string">'set_application_cursor'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'3'</span>: {
        <span class="keyword">if</span>(my.allow_width_change) {
          that.emit(<span class="string">'resize'</span>, state ? <span class="number">132</span> : <span class="number">80</span>);
          that.emit(<span class="string">'clear_home'</span>);
        }
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'5'</span>: {
        that.emit(<span class="string">'set_reverse_video'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'6'</span>: {
        that.emit(<span class="string">'set_origin_mode'</span>, state);
        that.emit(<span class="string">'set_cursor_position'</span>, <span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'7'</span>: {
        that.emit(<span class="string">'set_wrap_around'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'12'</span>: {
        that.emit(<span class="string">'set_cursor_blink'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'25'</span>: {
        that.emit(<span class="string">'set_cursor_visible'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'40'</span>: {
        my.allow_width_change = state ? <span class="literal">true</span> : <span class="literal">false</span>;
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'45'</span>: {
        that.emit(<span class="string">'set_reverse_wrap_around'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'67'</span>: {
        that.emit(<span class="string">'set_keyboard_backspace_sends_backspace'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1000'</span>: {
        <span class="comment">/* TODO: mouse */</span>
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1002'</span>: {
        <span class="comment">/* TODO: mouse */</span>
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1010'</span>: {
        that.emit(<span class="string">'set_scroll_on_output'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1011'</span>: {
        that.emit(<span class="string">'set_scroll_on_keystroke'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1036'</span>: {
        that.emit(<span class="string">'set_keyboard_meta_sends_escape'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1039'</span>: {
        that.emit(<span class="string">'set_keyboard_alt_sends_escape'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'47'</span>:
      <span class="keyword">case</span> <span class="string">'1047'</span>: {
        that.emit(<span class="string">'set_alternate_mode'</span>, state);
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1048'</span>: {
        save_cursor();
        <span class="keyword">break</span>;
      }
      <span class="keyword">case</span> <span class="string">'1049'</span>: {
        <span class="keyword">if</span>(state) {
          save_cursor();
          that.emit(<span class="string">'set_alternate_mode'</span>, state);
          that.emit(<span class="string">'clear'</span>);
        }
        <span class="keyword">else</span> {
          that.emit(<span class="string">'set_alternate_mode'</span>, state);
          restore_cursor();
        }
        <span class="keyword">break</span>;
      }
      <span class="keyword">default</span>: {
        <span class="keyword">if</span>(my.warn)
          factory.log().out(<span class="string">'Unimplemented DEC Private Mode: '</span> + code);
      }
    }
  };



  <span class="comment">/****************************************************************************/</span>
  <span class="comment">/*                             CONTROL SEQUENCES                            */</span>
  <span class="comment">/****************************************************************************/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3>ignore</h3>
<p>Ignore handler use to ignore an action and test equality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ignore = <span class="keyword">function</span>() {};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h3>CC1</h3>
<p>Collection of control chracters expressed in a single byte.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.CC1 = {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Null (NUL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x00'</span>: <span class="keyword">function</span>() {},</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Enquiry (ENQ)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x05'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Ring Bell (BEL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x07'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'ring_bell'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Backspace (BS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x08'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_left'</span>, <span class="number">1</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Horizontal Tab (HT)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x09'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'forward_tab_stop'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Line Feed (LF)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x0a'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'line_feed'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Vertical Tab (VT)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x0b'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'form_feed'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Form Feed (FF)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x0c'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'form_feed'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Carriage Return (CR)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x0d'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_cursor_column'</span>, <span class="number">0</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Shift Out (SO), aka Lock Shift 1 (LS1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x0e'</span>: <span class="keyword">function</span>() {
      my.GL = <span class="string">'G1'</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Shift In (SI), aka Lock Shift 0 (LS0)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x0f'</span>: <span class="keyword">function</span>() {
      my.GL = <span class="string">'G0'</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Transmit On (XON)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x11'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Transmit Off (XOFF)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x13'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Cancel (CAN)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x18'</span>: <span class="keyword">function</span>() {
      my.state.reset_fun();
      that.emit(<span class="string">'print'</span>, <span class="string">'?'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Substitute (SUB)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x1a'</span>: <span class="keyword">function</span>() {
      my.state.reset_fun();
      that.emit(<span class="string">'print'</span>, <span class="string">'?'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Escape (ESC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x1b'</span>: <span class="keyword">function</span>() {
      <span class="function"><span class="keyword">function</span> <span class="title">parse_esc</span><span class="params">()</span> {</span>
        <span class="keyword">var</span> ch = my.state.consume();
        <span class="keyword">if</span>(ch === <span class="string">'\x1b'</span>)
          <span class="keyword">return</span>;
        dispatch(<span class="string">'ESC'</span>, ch);
        <span class="keyword">if</span>(my.state.fun() === parse_esc)
          my.state.reset_fun();
      };
      my.state.set_fun(parse_esc);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Delete (DEL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x7f'</span>: ignore
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h3>CC1 Regexp</h3>
<p>Constructed to quickly scan the known 1-byte control chars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> acc = Object.keys(my.CC1).map(<span class="keyword">function</span>(e) {
    <span class="keyword">return</span> <span class="string">'\\x'</span> + common.zpad(e.charCodeAt().toString(<span class="number">16</span>), <span class="number">2</span>)
  }).join(<span class="string">''</span>);
  my.cc1_r = <span class="keyword">new</span> RegExp(<span class="string">'['</span> + acc + <span class="string">']'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h3>ESC</h3>
<p>Collection of control two-byte and three-byte sequences 
starting with ESC.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.ESC = {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Index (IND)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'D'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'line_feed'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Next Line (NEL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'E'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_cursor_column'</span>, <span class="number">0</span>);
      that.emit(<span class="string">'cursor_down'</span>, <span class="number">1</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Horizontal Tabulation Set (HTS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'H'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_tab_stop_current'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Reverse Index (RI)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'M'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'reverse_line_feed'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Single Shift 2 (SS2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'N'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Single Shift 3 (SS3)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'O'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Device Control String (DCS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'P'</span>: <span class="keyword">function</span>() {
      my.state.reset_args();
      my.state.set_fun(parse_until_string_terminator);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Start of Pretected Area (SPA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'V'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>End of Protected Area (EPA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'W'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Start of String (SOS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'X'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Single Character Introducer (SCI, also DECID)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'Z'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[?1;2c'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Control Sequence Introducer (CSI)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'['</span>: <span class="keyword">function</span>() {
      my.state.reset_args();
      my.leading_modifier = <span class="string">''</span>;
      my.trailing_modifier = <span class="string">''</span>;
      my.state.set_fun(parse_csi);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>String Terminator (ST)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\\'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Operating System Command (OSC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">']'</span>: <span class="keyword">function</span>() {
      my.state.reset_args();
      <span class="function"><span class="keyword">function</span> <span class="title">parse_osc</span><span class="params">()</span> {</span>
        <span class="keyword">if</span>(!parse_until_string_terminator()) {
          <span class="comment">/* The string was too long or invalid */</span>
          <span class="keyword">return</span>;
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(my.state.fun() === parse_osc) {
          <span class="comment">/* We're not done parsing the string yet */</span>
          <span class="keyword">return</span>;
        }
        <span class="keyword">else</span> {
          <span class="comment">/* We're done */</span>
          <span class="keyword">var</span> ary_r = <span class="regexp">/^(\d+);(.*)$/</span>;
          <span class="keyword">var</span> ary_m = my.state.args()[<span class="number">0</span>].match(ary_r);
          <span class="keyword">if</span>(ary_m) {
            my.state.args()[<span class="number">0</span>] = ary_m[<span class="number">2</span>];
            dispatch(<span class="string">'OSC'</span>, ary_m[<span class="number">1</span>]);
          }
          <span class="keyword">else</span> {
            factory.log().out(<span class="string">'Invalid OSC: '</span> + my.state.args()[<span class="number">0</span>]);
          }
        }
      };
      my.state.set_fun(parse_osc);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Privacy Message (PM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'^'</span>: <span class="keyword">function</span>() {
      my.state.reset_args();
      my.state.set_fun(parse_until_string_terminator);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Application Program Control (APC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'_'</span>: <span class="keyword">function</span>() {
      my.state.reset_args();
      my.state.set_fun(parse_until_string_terminator);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>xterm &#39;ESC 0x20&#39; Sequence</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\x20'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> parse = <span class="keyword">function</span>() {
        <span class="keyword">var</span> ch = my.state.consume();
        <span class="keyword">if</span>(my.warn) {
          factory.log().out(<span class="string">'Unimplemented Sequence: ESC 0x20 '</span> + ch);
        }
        my.state.reset_fun();
      };
      my.state.set_fun(parse);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>DEC &#39;ESC #&#39; Sequences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'#'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> parse = <span class="keyword">function</span>() {
        <span class="keyword">var</span> ch = my.state.consume();
        <span class="keyword">if</span>(ch === <span class="string">'8'</span>) {
          that.emit(<span class="string">'fill'</span>, <span class="string">'E'</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">'3456'</span>.indexOf(ch) === -<span class="number">1</span>) {
          <span class="comment">/* Echo to terminal all non reserved sequences */</span>
          that.emit(<span class="string">'print'</span>, <span class="string">'\x1b#'</span> + ch);
        }
        my.state.reset_fun();
      };
      my.state.set_fun(parse);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>&#39;ESC %&#39; Sequences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'%'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> parse = <span class="keyword">function</span>() {
        <span class="keyword">var</span> ch = my.state.consume();
        <span class="keyword">if</span> (my.warn) {
          factory.log().out(<span class="string">'Unknown/Unimplemented Seuqnce : ESC % '</span> + ch);
        }
        my.state.reset_fun();
      };
      my.state.set_fun(parse);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Back Index (DECBI)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'6'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Save Cursor (DECSC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'7'</span>: <span class="keyword">function</span>() {
      save_cursor();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Restore Cursor (DECRC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'8'</span>: <span class="keyword">function</span>() {
      restore_cursor();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Application Keypad (DECPAM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'='</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_application_keypad'</span>, <span class="literal">true</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Normal Keypad (DECPNM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_application_keypad'</span>, <span class="literal">false</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Cursor to Lower Left (xterm only)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'F'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Full Reset (RIS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'c'</span>: <span class="keyword">function</span>() {
      reset()
      that.emit(<span class="string">'reset'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Memory Lock / Unlock</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'l'</span>: ignore,
    <span class="string">'m'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Lock Shift 2 (LS2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'n'</span>: <span class="keyword">function</span>() {
      my.GL = <span class="string">'G2'</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Lock Shift 3 (LS3)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'o'</span>: <span class="keyword">function</span>() {
      my.GL = <span class="string">'G3'</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Lock Shift 3, Right (LS3R)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'|'</span>: <span class="keyword">function</span>() {
      my.GR = <span class="string">'G3'</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Lock Shift 2, Right (LS2R)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'}'</span>: <span class="keyword">function</span>() {
      my.GR = <span class="string">'G1'</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Lock Shift 1, Right (LS1R)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'~'</span>: <span class="keyword">function</span>() {
      my.GR = <span class="string">'G1'</span>;
    },
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Character Set Selection (SCS) </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.ESC[<span class="string">'('</span>] =
  my.ESC[<span class="string">')'</span>] =
  my.ESC[<span class="string">'*'</span>] =
  my.ESC[<span class="string">'+'</span>] =
  my.ESC[<span class="string">'-'</span>] =
  my.ESC[<span class="string">'.'</span>] =
  my.ESC[<span class="string">'/'</span>] = <span class="keyword">function</span>(code) {
    <span class="keyword">var</span> parse = <span class="keyword">function</span>() {
      <span class="keyword">var</span> ch = my.state.consume();
      <span class="keyword">if</span>(ch === <span class="string">'\x1b'</span>) {
        my.state.reset_fun();
        my.state.fun()();
        <span class="keyword">return</span>;
      }
      <span class="keyword">if</span>(ch <span class="keyword">in</span> require(<span class="string">'./char_map.js'</span>).maps) {
        <span class="keyword">if</span>(code === <span class="string">'('</span>) {
          my.G0 = require(<span class="string">'./char_map.js'</span>).maps[ch];
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(code ===<span class="string">')'</span> || code === <span class="string">'-'</span>) {
          my.G1 = require(<span class="string">'./char_map.js'</span>).maps[ch];
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(code ===<span class="string">'*'</span> || code === <span class="string">'.'</span>) {
          my.G2 = require(<span class="string">'./char_map.js'</span>).maps[ch];
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(code ===<span class="string">'+'</span> || code === <span class="string">'/'</span>) {
          my.G3 = require(<span class="string">'./char_map.js'</span>).maps[ch];
        }
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.warn) {
        factory.log().out(<span class="string">'Invalid Character Set: '</span> + ch + 
                          <span class="string">' for code: '</span> + code);
      }
      my.state.reset_fun();
    };
    my.state.set_fun(parse);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <h3>OSC</h3>
<p>Collection of OSC (Operating System Control) sequences.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.OSC = {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Change Icon Name and Window Title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'0'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_window_title'</span>, my.state.args()[<span class="number">0</span>]);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Change Window Title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'2'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_window_title'</span>, my.state.args()[<span class="number">0</span>]);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Set/Read Color Palette</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'4'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Set/Read System Clipboard</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'52'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> args_r = <span class="regexp">/^[cps01234567]+;(.*)$/</span>;
      <span class="keyword">var</span> args_m = my.state.args()[<span class="number">0</span>].match(args_r);
      <span class="keyword">if</span>(!args_m)
        <span class="keyword">return</span>;
      <span class="keyword">var</span> data = <span class="keyword">new</span> Buffer(args_m[<span class="number">1</span>], <span class="string">'base64'</span>).toString(<span class="string">'utf8'</span>) 
      <span class="keyword">if</span>(data &amp;&amp; data.length &gt; <span class="number">0</span>)
        that.emit(<span class="string">'copy_to_clipboard'</span>, data);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <h3>CSI</h3>
<p>Collection of CSI (Control Sequence Introducer) sequences.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.CSI = {</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Insert (blank) characters (ICH)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'@'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'insert_chars'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Cursor Up (CUU)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'A'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_up'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Cursor Down (CUD)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'B'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_down'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Cursor Forward (CUF)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'C'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_right'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Cursor Backward (CUB)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'D'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_left'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Cursor Next Line (CNL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'E'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_down'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
      that.emit(<span class="string">'set_cursor_column'</span>, <span class="number">0</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Cursor Preceding Line (CPL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'F'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'cursor_up'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
      that.emit(<span class="string">'set_cursor_column'</span>, <span class="number">0</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Cursor Character Absolute (CHA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'G'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_cursor_column'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>) - <span class="number">1</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Cursor Position (CUP)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'H'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_cursor_position'</span>, 
                my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>) - <span class="number">1</span>,
                my.state.int_arg(<span class="number">1</span>, <span class="number">1</span>) - <span class="number">1</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Cursor Forward Tabulation (CHT)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'I'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> count = my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>);
      <span class="comment">/* Overflow is checked by `term` (see clamp in `next_stop`) */</span>
      that.emit(<span class="string">'forward_tab_stop'</span>, count);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Erase in Display (ED, DECSED)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'J'</span>: <span class="keyword">function</span>(code) {
      <span class="keyword">var</span> arg = my.state.args()[<span class="number">0</span>];

      <span class="keyword">if</span>(!arg || arg === <span class="string">'0'</span>) {
        that.emit(<span class="string">'erase_below'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="string">'1'</span>) {
        that.emit(<span class="string">'erase_above'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="string">'2'</span>) {
        that.emit(<span class="string">'clear'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="string">'3'</span>) {
        <span class="comment">/* xterm "Erase saved lines" -&gt; clear */</span>
        that.emit(<span class="string">'clear'</span>);
      }
      <span class="keyword">else</span> {
        that.emit(<span class="string">'print'</span>, <span class="string">'\x1b['</span> + code + args[<span class="number">0</span>]);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Erase in Line (EL, DECSEL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'K'</span>: <span class="keyword">function</span>(code) {
      <span class="keyword">var</span> arg = my.state.args()[<span class="number">0</span>];

      <span class="keyword">if</span>(!arg || arg === <span class="string">'0'</span>) {
        that.emit(<span class="string">'erase_right'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="string">'1'</span>) {
        that.emit(<span class="string">'erase_left'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="string">'2'</span>) {
        that.emit(<span class="string">'erase_line'</span>);
      }
      <span class="keyword">else</span> {
        that.emit(<span class="string">'print'</span>, <span class="string">'\x1b['</span> + code + args[<span class="number">0</span>]);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Insert Lines (IL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'L'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'insert_lines'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Delete Lines (DL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'M'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'delete_lines'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Delete Characters (DCH)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'P'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'delete_chars'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Scroll Up (SU)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'S'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'scroll_up'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Scroll Down (SD)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'T'</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(my.state.args().length &lt;= <span class="number">1</span>)
        that.emit(<span class="string">'scroll_down'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Reset Title Mode Features</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;T'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Erase Characters (ECH)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'X'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'erase_right'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>))
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Cursor Bakcward Tabulation (CBT)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'Z'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> count = my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>);
      <span class="comment">/* Overflow is checked by `term` (see clamp in `prev_stop`) */</span>
      that.emit(<span class="string">'backward_tab_stop'</span>, count);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Character Position Absolute (HPA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'`'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_cursor_column'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>) - <span class="number">1</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Repeat Graphic Character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'b'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Send Device Attribute (Primary DA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'c'</span>: <span class="keyword">function</span>() {
      <span class="comment">/* Hard coded to VT100. Upgradable to VT200 w/ implementation */</span>
      <span class="keyword">if</span>(!my.state.args()[<span class="number">0</span>] || my.state.args()[<span class="number">0</span>] === <span class="string">'0'</span>) {
        that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[?1;2c'</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Send Device Attribute (Secondary DA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;c'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[&gt;0;256;0c'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Line Position Absolute (VPA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'d'</span>: <span class="keyword">function</span>() {
      that.emit(<span class="string">'set_cursor_row'</span>, my.state.int_arg(<span class="number">0</span>, <span class="number">1</span>) - <span class="number">1</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Tab Clear (TBC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'g'</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(!my.state.args()[<span class="number">0</span>] || my.state.args()[<span class="number">0</span>] === <span class="string">'0'</span>) {
        that.emit(<span class="string">'clear_tab_stop'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'3'</span>) {
        that.emit(<span class="string">'clear_all_tab_stops'</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Set Mode (SM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'h'</span>: <span class="keyword">function</span>() {
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; my.state.args().length; i ++) {
        set_ansi_mode(my.state.args()[i], <span class="literal">true</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>DEC Private Mode Set (DECSET)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'?h'</span>: <span class="keyword">function</span>() {
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; my.state.args().length; i ++) {
        set_dec_mode(my.state.args()[i], <span class="literal">true</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Media Copy (MC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'i'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Media Copy (MC, DEC Specific)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'?i'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Reset Mode (RM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'l'</span>: <span class="keyword">function</span>() {
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; my.state.args().length; i ++) {
        set_ansi_mode(my.state.args()[i], <span class="literal">false</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>DEC Private Mode Reset (DECRST)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'?l'</span>: <span class="keyword">function</span>() {
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; my.state.args().length; i ++) {
        set_dec_mode(my.state.args()[i], <span class="literal">false</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Character Attributes (SGR)
Iterate through the list of arguments, applying the following attribute
changes based on the argument value...</p>
<p>  0 Normal (default).
  1 Bold.
  4 Underlined.
  5 Blink (appears as Bold).
  7 Reverse.
  8 Invisible, i.e., hidden (VT300).
 22 Normal (neither bold nor faint).
 24 Not underlined.
 25 Steady (not blinking).
 27 Positive (not reverse).
 28 Visible, i.e., not hidden (VT300).
 30 Set foreground color to Black.
 31 Set foreground color to Red.
 32 Set foreground color to Green.
 33 Set foreground color to Yellow.
 34 Set foreground color to Blue.
 35 Set foreground color to Magenta.
 36 Set foreground color to Cyan.
 37 Set foreground color to White.
 39 Set foreground color to default (original).
 40 Set background color to Black.
 41 Set background color to Red.
 42 Set background color to Green.
 43 Set background color to Yellow.
 44 Set background color to Blue.
 45 Set background color to Magenta.
 46 Set background color to Cyan.
 47 Set background color to White.
 49 Set background color to default (original)</p>
<p>For 16-color support, the following apply.</p>
<p> 90 Set foreground color to Bright Black.
 91 Set foreground color to Bright Red.
 92 Set foreground color to Bright Green.
 93 Set foreground color to Bright Yellow.
 94 Set foreground color to Bright Blue.
 95 Set foreground color to Bright Magenta.
 96 Set foreground color to Bright Cyan.
 97 Set foreground color to Bright White.
100 Set background color to Bright Black.
101 Set background color to Bright Red.
102 Set background color to Bright Green.
103 Set background color to Bright Yellow.
104 Set background color to Bright Blue.
105 Set background color to Bright Magenta.
106 Set background color to Bright Cyan.
107 Set background color to Bright White.</p>
<p>For 88- or 256-color support, the following apply.
 38 ; 5 ; P Set foreground color to P.
 48 ; 5 ; P Set background color to P.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'m'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> get256 = <span class="keyword">function</span>(i) {
        <span class="keyword">if</span>(my.state.args().length &lt; i + <span class="number">2</span> || my.state.args()[i + <span class="number">1</span>] !== <span class="string">'5'</span>)
          <span class="keyword">return</span> <span class="literal">null</span>;
        <span class="keyword">return</span> my.state.int_arg(i + <span class="number">2</span>, <span class="number">0</span>);
      };

      <span class="keyword">if</span>(!my.state.args().length) {
        that.emit(<span class="string">'char_attr_reset'</span>);
        <span class="keyword">return</span>;
      }
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; my.state.args().length; i++) {
        <span class="keyword">var</span> arg = my.state.int_arg(i, <span class="number">0</span>);

        <span class="keyword">if</span>(arg &lt; <span class="number">30</span>) {
          <span class="keyword">if</span>(arg === <span class="number">0</span>)
            that.emit(<span class="string">'char_attr_reset'</span>);
          <span class="keyword">if</span>(arg === <span class="number">1</span>)
            that.emit(<span class="string">'char_attr_set_bold'</span>, <span class="literal">true</span>);
          <span class="keyword">if</span>(arg === <span class="number">3</span>)
            that.emit(<span class="string">'char_attr_set_italic'</span>, <span class="literal">true</span>);
          <span class="keyword">if</span>(arg === <span class="number">4</span>)
            that.emit(<span class="string">'char_attr_set_underline'</span>, <span class="literal">true</span>);
          <span class="keyword">if</span>(arg === <span class="number">5</span>)
            that.emit(<span class="string">'char_attr_set_blink'</span>, <span class="literal">true</span>);
          <span class="keyword">if</span>(arg === <span class="number">7</span>)
            that.emit(<span class="string">'char_attr_set_reverse'</span>, <span class="literal">true</span>);
          <span class="keyword">if</span>(arg === <span class="number">8</span>)
            that.emit(<span class="string">'char_attr_set_invisible'</span>, <span class="literal">true</span>);
          <span class="keyword">if</span>(arg === <span class="number">21</span> || arg === <span class="number">22</span>)
            that.emit(<span class="string">'char_attr_set_bold'</span>, <span class="literal">false</span>);
          <span class="keyword">if</span>(arg === <span class="number">23</span>)
            that.emit(<span class="string">'char_attr_set_italic'</span>, <span class="literal">false</span>);
          <span class="keyword">if</span>(arg === <span class="number">24</span>)
            that.emit(<span class="string">'char_attr_set_underline'</span>, <span class="literal">false</span>);
          <span class="keyword">if</span>(arg === <span class="number">25</span>)
            that.emit(<span class="string">'char_attr_set_blink'</span>, <span class="literal">false</span>);
          <span class="keyword">if</span>(arg === <span class="number">27</span>)
            that.emit(<span class="string">'char_attr_set_reverse'</span>, <span class="literal">false</span>);
          <span class="keyword">if</span>(arg === <span class="number">28</span>)
            that.emit(<span class="string">'char_attr_set_invisible'</span>, <span class="literal">false</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(arg &lt; <span class="number">50</span>) {
          <span class="comment">/* foreground */</span>
          <span class="keyword">if</span>(arg &lt; <span class="number">38</span>) {
            that.emit(<span class="string">'char_attr_set_foreground_index'</span>, arg - <span class="number">30</span>);
          }
          <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="number">38</span>) {
            <span class="keyword">var</span> c = get256(i);
            <span class="keyword">if</span>(c === <span class="literal">null</span>) <span class="keyword">break</span>;
            i+= <span class="number">2</span>;
            that.emit(<span class="string">'char_attr_set_foreground_index'</span>, c);
          }
          <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="number">39</span>) {
            that.emit(<span class="string">'char_attr_set_foreground_index'</span>, <span class="literal">null</span>);
          }
          <span class="comment">/* background */</span>
          <span class="keyword">else</span> <span class="keyword">if</span>(arg &lt; <span class="number">48</span>) {
            that.emit(<span class="string">'char_attr_set_background_index'</span>, arg - <span class="number">40</span>);
          }
          <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="number">48</span>) {
            <span class="keyword">var</span> c = get256(i);
            <span class="keyword">if</span>(c === <span class="literal">null</span>) <span class="keyword">break</span>;
            i+= <span class="number">2</span>;
            that.emit(<span class="string">'char_attr_set_background_index'</span>, c);
          }
          <span class="keyword">else</span> <span class="keyword">if</span>(arg === <span class="number">49</span>) {
            that.emit(<span class="string">'char_attr_set_background_index'</span>, <span class="literal">null</span>);
          }
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(arg &gt;= <span class="number">90</span> &amp;&amp; arg &lt;= <span class="number">97</span>) {
          that.emit(<span class="string">'char_attr_set_foreground_index'</span>, arg - <span class="number">90</span> + <span class="number">8</span>);
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(arg &gt;= <span class="number">100</span> &amp;&amp; arg &lt;= <span class="number">107</span>) {
          that.emit(<span class="string">'char_attr_set_background_index'</span>, arg - <span class="number">100</span> + <span class="number">8</span>);
        }
      }
      <span class="comment">/* TODO: set default value for term char attrs  */</span>
      <span class="comment">/* attrs.setDefaults(term.getForegroundColor(), */</span>
      <span class="comment">/*                   term.getBackgroundColor()) */</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Set xterm-specific Keyboard Modes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;m'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Device Status Report (DSR, DEC Specific)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'n'</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'5'</span>) {
        that.emit(<span class="string">'write'</span>, <span class="string">'\x1b0n'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.parse_state.args()[<span class="number">0</span>] === <span class="string">'6'</span>) {
        that.emit(<span class="string">'report_cursor_position'</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Disable xterm-specific Keyboard Modes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;n'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Device Status Report (DSR, DEC Specific)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'?n'</span>: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'6'</span>) {
        that.emit(<span class="string">'report_cursor_position'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'15'</span>) {
        that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[?11n'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'25'</span>) {
        that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[?21n'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'26'</span>) {
        that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[?12;1;0;0n'</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(my.state.args()[<span class="number">0</span>] === <span class="string">'53'</span>) {
        that.emit(<span class="string">'write'</span>, <span class="string">'\x1b[?50n'</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Hide Pointer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;p'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Soft Terminal Reset (DECSTR)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'!p'</span>: <span class="keyword">function</span>() {
      reset();
      that.emit(<span class="string">'soft_reset'</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Request ANSI Mode (DECRQM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'$p'</span>: ignore,
    <span class="string">'?$p'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Set Performance Level (DECSCL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'"p'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Load LEDs (DECLL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'q'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Set Cursor Style (DECSCUSR, VT520)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">' q'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Select Character Protection Attribute (DECSCA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'"q'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Set Scrolling Region (DECSTBM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'r'</span>: <span class="keyword">function</span>() {
      <span class="keyword">var</span> args = my.state.args();
      <span class="keyword">var</span> scroll_top = args[<span class="number">0</span>] ? parseInt(args[<span class="number">0</span>], <span class="number">10</span>) - <span class="number">1</span> : <span class="literal">null</span>;
      <span class="keyword">var</span> scroll_bottom = args[<span class="number">1</span>] ? parseInt(args[<span class="number">1</span>], <span class="number">10</span>) - <span class="number">1</span> : <span class="literal">null</span>;
      that.emit(<span class="string">'set_scroll_region'</span>, scroll_top, scroll_bottom);
      that.emit(<span class="string">'set_cursor_position'</span>, <span class="number">0</span>, <span class="number">0</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Restore DEC Private Mode Values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'?r'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Change Attributes in Rectangular Area (DECCARA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'$r'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Save Cursor (ANSI.SYS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'s'</span>: <span class="keyword">function</span>() {
      save_cursor();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Save DEC Private Mode Values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'?s'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Window Manipulation (from dtterm)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'t'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Reverse Attributes in Rectangular Area (DECRARA)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'$t'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Set one or more Features of the Title Modes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'&gt;t'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Set Warning-Bell Volume (DECSWBV, VT520)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">' t'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Restore Cursor (ANSI.SYS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'u'</span>: <span class="keyword">function</span>() {
      restore_cursor();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Copy Rectangular Area (DECCRA, VT400)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'$v'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Enable Filter Rectangle (DECEFR)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\'w'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Request Terminal Parameters (DECREQTPARM)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'x'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Select Attribute Change Extent (DECSACE)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'*x'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Fill Rectangular Area (DECFRA, VT420)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'$x'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Enable Locator Reporting (DECELR)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\'z'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Erase Rectangular Area (DECERA, VT400)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'$z'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Select Locator Events (DECSLE)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\'{'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Request Locator Position (DECRQLP)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">'\'|'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Insert Columns (DECIC, VT420)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">' }'</span>: ignore,</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Delete P s Columns (DECDC, VT420)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="string">' ~'</span>: ignore
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Aliases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.CSI[<span class="string">'?J'</span>] = my.CSI[<span class="string">'J'</span>];
  my.CSI[<span class="string">'?K'</span>] = my.CSI[<span class="string">'K'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Horizontal and Vertical Position (HVP)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.CSI[<span class="string">'f'</span>] = my.CSI[<span class="string">'H'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <h3>VT52 sequences</h3>
<p>Collection of VT52 sequences.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  my.VT52 = {</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>...</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  };</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <h4><em>initialization</em></h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset();

  common.getter(that, <span class="string">'G0'</span>, my, <span class="string">'G0'</span>);
  common.setter(that, <span class="string">'G0'</span>, my, <span class="string">'G0'</span>);
  common.getter(that, <span class="string">'G1'</span>, my, <span class="string">'G1'</span>);
  common.setter(that, <span class="string">'G1'</span>, my, <span class="string">'G1'</span>);
  common.getter(that, <span class="string">'G2'</span>, my, <span class="string">'G2'</span>);
  common.setter(that, <span class="string">'G2'</span>, my, <span class="string">'G2'</span>);
  common.getter(that, <span class="string">'G3'</span>, my, <span class="string">'G3'</span>);
  common.setter(that, <span class="string">'G3'</span>, my, <span class="string">'G3'</span>);

  common.getter(that, <span class="string">'GR'</span>, my, <span class="string">'GR'</span>);
  common.setter(that, <span class="string">'GR'</span>, my, <span class="string">'GR'</span>);
  common.getter(that, <span class="string">'GL'</span>, my, <span class="string">'GL'</span>);
  common.setter(that, <span class="string">'GL'</span>, my, <span class="string">'GL'</span>);

  common.method(that, <span class="string">'read'</span>, read, _super);
  common.method(that, <span class="string">'reset'</span>, reset, _super);

  <span class="keyword">return</span> that;
};

exports.vt = vt;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
